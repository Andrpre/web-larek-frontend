# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание архитектуры

В проекте используется паттерн MVP. 

## Базовый код

### 1. Класс `Component<T>`

Абстрактный класс, реализует методы для работы с состоянием объектов и рендерит их на страницу. Класс является дженериком и принимает в переменной T тип данных элемента.

Конструктор принимает такой аргумент:

1. `container: HTMLElement` — html элемент.

Класс имеет такие методы:

- `toggleClass`, `setDisabled`, `setHidden`, `setVisible` — для работы с состоянием элемента (переключить класс, изменить статус блокировки, скрыть, показать).
- `setText`, `setImage`, `render` — для работы с элементами в DOM дереве (установить текстовое содержимое, установить изображение, вернуть корневой DOM-элемент).

### 2. Класс `Model<T>`

Абстрактный класс, предназначенный для работы по преобразованию данных. Класс является дженериком и принимает в переменной T тип данных объекта.

Конструктор принимает такие аргументы:

1. `data: Partial<T>` — данные для обработки.
2. `protected events: IEvents` — событие, которое реализует интерфейс `IEvents`.

Класс имеет такой метод:

- `emitChanges` — для сообщения об изменении модели.

### 3. Класс `Api`

Конструктор принимает такие аргументы:

1. `readonly baseUrl: string` — содержит основное тело эндпоинта.
2. `protected options: RequestInit` — содержит настройки по работе с запросами.

Класс имеет такие методы:

- `handleResponse` — обрабатывает запрос, возвращает промис в случае успеха.
- `get` — получает данные с сервера.
- `post` — отправляет данные на сервер.

### 4. Класс `EventEmitter`

Класс `EventEmitter` обеспечивает работу событий. Его функции: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события.

Класс имеет методы `on`,  `off`,  `emit`  — для установки обработчика на событие, снятия обработчика с события и инициации события с данными.

Дополнительно реализованы методы `onAll` и `offAll`  — для подписки на все события и сброса всех обработчиков.

Интересным дополнением является метод `trigger`, генерирующий заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса `EventEmitter`.

## Компоненты представления

### 1. Класс `ShopApi`

Класс `ShopApi` представляет собой реализацию интерфейса `IShopApi` и отвечает за взаимодействие с API для получения товаров и оформления заказа.

Конструктор принимает такие аргументы:

1. `cdn: string` — URL для контента.
2. `baseUrl: string` — базовый URL.
3. `options?: RequestInit)` — опции запроса.

Класс имеет такие методы:

- `getProductItem` — возвращает информацию о конкретном товаре по его идентификатору.
- `getProductList` — возвращает список товаров, доступных к приобретению.
- `orderProducts(order: IOrder): Promise` — делает POST-запрос к API для заказа товаров на основе предоставленного заказа (`IOrder`). После успешной отправки заказа метод возвращает данные о результате заказа (`IOrderResult`).

## Компоненты модели данных

### 1. Класс `AppState`

Содержит состояния различных компонентов и управляет этими состояниями. Класс `AppState` расширяет класс `Model` и имеет ожидаемый тип данных `<IAppState>`.

Класс имеет методы `clearBasket`,  `getTotal`,  `setCatalog`, `setOrderField`, `validateOrder`  — для управления логикой корзины и каталога.

## Компоненты отображения

### 1. Класс `Card`

Класс `Card` расширяет класс `Component` и реализуется для управления карточками товаров в проекте. 

Конструктор класса принимает несколько параметров для инициализации, включая имя блока `blockName`, контейнер `container` и дополнительные действия `actions`.

Класс имеет сеттеры: `id`, `title`, `image`, `description` и геттеры: `id`, `title`, через которые можно устанавливать и получать значения для заголовка, изображения и описания карточки, а также определять идентификатор карточки.

В классе также предусмотрена возможность установки обработчика событий на клик по карточке или кнопке.

### 2. Класс `Form`

Класс `Form` расширяет класс `Component` и отвечает за обработку элементов формы внутри заданного HTML-элемента формы. Он инициализируется с контейнером формы и объектом событий для обработки событий формы. Класс предоставляет методы для установки состояния валидности формы, отображения ошибок и рендеринга формы на основе предоставленного состояния.

Конструктор принимает два параметра:

1. `container` — HTML-элемент формы;
2. `events` — объект событий. Он настраивает слушатели событий для событий ввода и отправки на элементе формы.

Класс имеет такие методы:

- `onInputChange` — генерирует события при изменении значений ввода, предоставляя имя поля и его значение.
- `render` — обновляет состояние формы и рендерит ее соответствующим образом, включая обработку валидности, ошибок и значений ввода.

Также класс имеет 2 сеттера:

- `valid` — обновляет состояние отключения кнопки отправки формы на основе состояния валидности.
- `errors` — обновляет сообщения об ошибках, отображаемые на форме.

### 2. Класс `Order`

Класс `Order` расширяет класс `Form` и используется для работы с формой заказа. Он принимает контейнер формы и объект событий для обработки событий формы.

Класс имеет 2 сеттера: `phone` и `email` — используются для установки значений телефона и электронной почты в соответствующих полях формы. Они обращаются к соответствующим элементам формы по их именам и устанавливают значения.

### 3. Класс **`Page`**

Класс `Page` наследует функциональность класса `Component` и используется для управления элементами страницы приложения. Он принимает контейнер страницы и объект событий для обработки событий на странице.

В конструкторе класса инициализируются элементы страницы, такие как счётчик корзины, каталог товаров, обёртка страницы и элемент корзины. Также устанавливается обработчик события на клик по элементу корзины, который отправляет событие.

Класс имеет 3 сеттера: `counter`, `catalog` и `locked` — используются для установки значений счётчика корзины, элементов каталога и блокировки/разблокировки страницы соответственно.

### 4. Класс `Basket`

Класс `Basket` представляет собой компонент, отвечающий за отображение корзины покупок. Он содержит свойства и методы для управления списком товаров, общей стоимостью и выбранными товарами.

Конструктор принимает такие аргументы:

1. `container: HTMLElement` — контейнер для компонента корзины.
2. `events:EventEmitter` — обработчик событий для корзины.

Класс имеет такие методы:

- `items(items: HTMLElement[])` — устанавливает товары для отображения.
- `selected(items: string[])` — обновляет доступность кнопки.
- `total(total: number)` — устанавливает и отображает общую стоимость.

### 5. Класс **`Modal`**

Класс `Modal` представляет компонент модального окна, который позволяет отображать контент поверх основного контента и взаимодействовать с ним.

Конструктор принимает такие аргументы:

1. `container: HTMLElement` — контейнер для компонента модального окна.
2. `events: (IEvents)` — объект, предоставляющий возможность обработки событий модального окна.

Класс имеет такие методы:

- `content(value: HTMLElement)` — устанавливает контент модального окна.
- `open()` — открывает модальное окно.
- `close()` — закрывает модальное окно.
- `render(data: IModalData): HTMLElement` — используется для отображения модального окна с данными из объекта `data`.

События:

- `modal:open` — событие, возникающее при открытии модального окна.
- `modal:close` — событие, возникающее при закрытии модального окна.

### 6. Класс **`Success`**

Класс **`Success`** представляет компонент для отображения сообщения об успешном завершении какого-либо действия или операции.

Конструктор принимает такие аргументы:

1. `actions: ISuccessActions` — действия, связанные с успешным сообщением.
2. `container**:** HTMLElement` — контейнер для компонента успешного сообщения.

### 7. Класс **`Tabs`**

Класс **`Tabs`** представляет компонент для отображения вкладок, которые пользователь может выбирать для отображения соответствующего контента.

Конструктор принимает такие аргументы:

1. `actions: TabActions` — (опционально) действия, связанные с выбором вкладки.
2. `container: HTMLElement` — контейнер для компонента вкладок.

Класс имеет такие методы:

- `selected(name: string)` — устанавливает выбранную вкладку по имени.

## Ключевые типы данных

```jsx
//Данные, которые имеет товар
interface IProductItem {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
}
//Список товаров в корзине
type IBasketItem = Pick<IProductItem, 'id' | 'title' | 'price'>;
//Управлние состоянием
interface IAppState {
    catalog: IProductItem[];
    basket: string[];
    preview: string | null;
    order: IOrder | null;
    loading: boolean;
}
//Данные заказа
interface IOrderForm {
    payment: 'Онлайн' | 'При получении';
    address: string;
    email: string;
    phone: string;
}
//Список товаров в заказе
interface IOrder extends IOrderForm {
    items: string[]
}
//Ошибки формы
type FormErrors = Partial<Record<keyof IOrder, string>>;
//Результат заказа
interface IOrderResult {
    id: string;
    total: number;
}
```
