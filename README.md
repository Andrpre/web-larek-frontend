# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание архитектуры

В проекте используется паттерн MVP для организации архитектуры. Данные приложения хранятся в модели. Пользователи взаимодействуют со слоем представления, используя интерфейс. В проекте используются события для уведомления модели о изменениях состояния или выполнении определенных действий через слой презентер. Класс `EventEmitter` предоставляет механизм для этого, позволяя классам подписываться на события и реагировать на них без явной зависимости друг от друга.

**Модель (Model):**

В роли модели выступает класс `AppState`, который расширяет абстрактный класс `Model<IAppState>`. Он управляет состоянием приложения и предоставляет методы для изменения данных и уведомления об изменениях.

**Представление (View):**

В роли представления выступают компоненты отображения, такие как `Card`, `Form`, `Basket` и другие, которые расширяют абстрактный класс `Component`. Они отображают данные и реагируют на действия пользователя. Представления получают данные от презентера и отображают их на экране, а также передают пользовательские действия (например, клики или ввод данных) презентеру для обработки.

**Презентер (Presenter):**

Для данного приложения презентером ****является код, который находится в корневом `index.ts`. Там мы передаем информацию об изменении в слое представления в модель и наоборот, информируем слой представления о том, что модель поменялась, добавляя необходимую нам логику.

**Слой коммуникации:**

В данной архитектуре можно выделить классы `ShopApi` и `Api` в еще один слой — слой коммуникации. Классы `ShopApi` и `Api` используются для выполнения запросов к серверу и получения данных.

## Базовый код

### 1. Класс `Component<T>`

Абстрактный класс, реализует методы для работы с состоянием объектов и рендерит их на страницу. Класс является дженериком и принимает в переменной T тип данных элемента.

Конструктор принимает такой аргумент:

1. `container: HTMLElement` — html элемент.

Класс имеет такие методы:

- `toggleClass`, `setDisabled`, `setHidden`, `setVisible` — для работы с состоянием элемента (переключить класс, изменить статус блокировки, скрыть, показать).
- `setText`, `setImage`, `render` — для работы с элементами в DOM дереве (установить текстовое содержимое, установить изображение, вернуть корневой DOM-элемент).
- `formatPrice` — для форматирования цены в нужный формат. На вход принимает число (`numb: number`) и возвращает строку `string` в которой отображается цена с припиской “*синапсов*”.

### 2. Класс `Model<T>`

Абстрактный класс, предназначенный для работы по преобразованию данных. Класс является дженериком и принимает в переменной T тип данных объекта.

Конструктор класса принимает два параметра:

1. `data: Partial<T>` — частичные данные типа `T`, которые будут использованы для инициализации свойств модели. Тип `Partial<T>` означает, что все свойства типа `T` могут быть опциональными, то есть могут быть пропущены при передаче данных в конструктор.
2. `events: IEvents` — объект событий `IEvents`, который используется для уведомления об изменениях в модели. Это позволяет другим частям приложения подписываться на изменения модели и реагировать на них.

Оба параметра имеют модификаторы доступа `protected`, что означает, что они могут быть доступны в классах, которые наследуются от `Model<T>`, но не доступны извне класса или его экземпляров.

Класс имеет такой метод:

- `emitChanges` — для уведомления всех заинтересованных сторон о том, что модель была изменена. Метод принимает 2 параметра:
    1. `event: string` — название события, которое будет отправлено всем заинтересованным сторонам.
    2. `payload?: object` — (опционально) дополнительные данные, которые можно отправить вместе с событием.

### 3. Класс `Api`

Конструктор принимает такие аргументы:

1. `readonly baseUrl: string` — содержит основное тело эндпоинта.
2. `protected options: RequestInit` — содержит настройки по работе с запросами.

Класс имеет такие методы:

- `handleResponse` — обрабатывает запрос, возвращает промис в случае успеха.
- `get` — получает данные с сервера.
- `post` — отправляет данные на сервер.

### 4. Класс `EventEmitter`

Класс `EventEmitter` обеспечивает работу событий. Его функции: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события.

Класс имеет методы `on`,  `off`,  `emit`  — для установки обработчика на событие, снятия обработчика с события и инициации события с данными.

Дополнительно реализованы методы `onAll` и `offAll`  — для подписки на все события и сброса всех обработчиков.

Дополнением является метод `trigger`, генерирующий заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса `EventEmitter`.

## Компоненты коммуникации

### 1. Класс `ShopApi`

Класс `ShopApi` расширяет класс `Api` и реализует интерфейс `IShopApi`. Он отвечает за взаимодействие с API для получения товаров и оформления заказа.

Конструктор принимает такие аргументы:

1. `cdn: string` — URL для контента.
2. `baseUrl: string` — базовый URL.
3. `options?: RequestInit)` — опции запроса.

Класс имеет такие методы:

- `getProductItem(id: string): Promise<IProductItem>` — возвращает информацию о конкретном товаре по его идентификатору.
- `getProductList(): Promise<IProductItem[]>` — возвращает список товаров, доступных к приобретению.
- `orderProducts(order: IOrder): Promise<IOrderResult>` — делает POST-запрос к API для заказа товаров на основе предоставленного заказа (`IOrder`). После успешной отправки заказа метод возвращает данные о результате заказа (`IOrderResult`).

## Компоненты модели данных

### 1. Класс `AppState`

Класс `AppState` расширяет абстрактный класс `Model<IAppState>`, что делает его моделью, предназначенной для управления состоянием приложения.

Свойства класса:

- `basketItems: IProductItem[]` — массив объектов, представляющий элементы в корзине.
- `catalog: IProductItem[]` — массив объектов, представляющих элементы каталога.
- `order: IOrderForm` —  объект, представляющий данные заказа, с полями `payment`, `address`, `email`, `phone`.
- `formErrors: FormErrors` — объект, представляющий ошибки в форме заказа.

Методы класса:

- `setCartItems(item: IProductItem)` —  добавляет товары в свойство класса `basketItems` для отображения в корзине и сообщает о том, что корзина изменилась.
- `getCartItems(): IProductItem[]` —  возвращает массив товаров из свойства `basketItems` данного класса.
- `removeItem(item: IProductItem)` — получает на вход объект с данными товара и удаляет его из свойства `basketItems` данного класса.
- `getTotal(): number` — возвращает общую сумму всех товаров в корзине.
- `getOrderDeta(): IOrder` — возвращает объект с данными о заказе для отправки на сервер.
- `clearBasket()` —  очищает корзину.
- `setCatalog(items: IProductItem[])` —  устанавливает каталог товаров, обновляя его элементами из параметра `items`.
- `setPreview(item: IProductItem)` — инициирует событие на отрисовку модального окна с детализацией информации по конкретному товару.
- `setOrderField(field: keyof IOrderForm, value: string)` — устанавливает значение из поля контактной формы и, если заказ прошел валидацию, сообщает о готовности заказа.
- `validateOrder()` — проверяет правильность введенных данных в заказе и обновляет объект `formErrors` с соответствующими ошибками, а затем сообщает об ошибках.

Этот класс обеспечивает управление состоянием приложения, предоставляя методы для изменения данных и проверки их корректности, а также уведомляя другие части приложения о любых изменениях с помощью метода `emitChanges` из класса `Model`.

## Компоненты отображения

### 1. Класс `Card`

Этот класс `Card<T>` расширяет класс `Component` и представляет собой компонент карточки, который используется для отображения элементов в интерфейсе.

`_title`, `_image`, `_category`, `_price`, `_description`, `_button`, `_index`: приватные свойства, представляющие заголовок, изображение, категорию, стоимость, индекс и кнопку.

`_description`, `_category`, `_image`, `_index`, `_button`: являются не обязательными свойствами и заполняются в зависимости от контекста (например не актуальны для отображения в каталоге, но актуальны в модальном окне).

Конструктор принимает такие аргументы:

- `blockName` —  строка, представляющая название блока карточки, используется для поиска элементов карточки в DOM.
- `container` — элемент контейнера, в который будет встроен компонент карточки.
- `actions` — действия, которые могут быть выполнены с карточкой.

Методы класса:

- `id` — геттер и сеттер для идентификатора карточки (позволяет получать или устанавливать идентификатор).
- `title` — геттер и сеттер для заголовка карточки (позволяет получать или устанавливать заголовок).
- `image(value: string)` — сеттер для изображения карточки (позволяет устанавливать изображение).
- `category(value: string)` — сеттер для категории товара (позволяет устанавливать категорию).
- `price(value: number)` — сеттер для цены товара (позволяет устанавливать цену).
- `index(value: number)` — сеттер для индекса товара (позволяет нумерацию товара в корзине).
- `description(value: string | string[])` — сеттер для описания карточки. Может принимать как строку, так и массив строк для многострочного описания (позволяет устанавливать описание товара).
- `toggleAvailability(value: string, state: boolean)` — метод для управления доступностью кнопки “*В корзину*". Принимает на вход 2 параметра:
    1. `value: string` — текст кнопки, который должен отобразится.
    2. `state: boolean` — состояние на которое нужно переключить кнопку.

Этот класс обеспечивает удобное управление содержимым карточки, таким как заголовок, изображение и описание, и предоставляет возможность определения пользовательских действий, таких как клики на карточке.

### 2. Класс `Form`

Класс `Form` расширяет класс `Component` и отвечает за обработку элементов формы внутри заданного HTML-элемента формы. Он инициализируется с контейнером формы и объектом событий для обработки событий формы. Класс предоставляет методы для установки состояния валидности формы, отображения ошибок и рендеринга формы на основе предоставленного состояния.

Конструктор принимает два параметра:

1. `container: HTMLFormElement` — HTML-элемент формы;
2. `events: IEvents` — объект событий `IEvents`, который используется для уведомления об изменениях в модели. Это позволяет другим частям приложения подписываться на изменения модели и реагировать на них.

Класс имеет такие методы:

- `onInputChange` — генерирует события при изменении значений ввода, предоставляя имя поля и его значение.
- `render` — переопределяет метод родительского класса. Он обновляет состояние формы и рендерит ее соответствующим образом, включая обработку валидности, ошибок и значений ввода.

Также класс имеет 2 сеттера:

- `valid` — управляет состоянием кнопки отправки формы на основе состояния валидности.
- `errors` — обновляет сообщения об ошибках, отображаемые на форме.

### 2. Класс `Order`

Класс `Order` расширяет класс `Form` и используется для работы с формой заказа. Он принимает контейнер формы, объект событий для обработки событий и объект для обработки клика. В конструкторе данного класса событие по клику вешается на каждую кнопку оплаты в форме и отвечает за выбор способа оплаты. 

Класс имеет 2 сеттера: `address` и `payment` — используются для установки значений адреса и способа оплаты в соответствующих полях формы. Они обращаются к соответствующим элементам формы по их именам и устанавливают значения.

### 3. Класс `Contacts`

Класс `Contacts` расширяет класс `Form` и используется для работы с формой контактных данных. Он принимает контейнер формы и объект событий для обработки событий формы.

Класс имеет 2 сеттера: `phone` и `email` — используются для установки значений телефона и электронной почты в соответствующих полях формы. Они обращаются к соответствующим элементам формы по их именам и устанавливают значения.

### 4. Класс **`Page`**

Класс `Page` наследует функциональность класса `Component` и используется для управления элементами страницы приложения.

Конструктор принимает два параметра:

- `container: HTMLElement` — контейнер страницы.
- `events: IEvents` — объект событий для обработки событий на странице. Он предоставляет метод `emit` для генерации событий и другие части кода могут подписаться на это событие и реагировать соответствующим образом.

В конструкторе класса инициализируются элементы страницы, такие как счётчик корзины, каталог товаров, обёртка страницы и элемент корзины. Также устанавливается обработчик события на клик по элементу корзины, который отправляет событие.

Класс имеет 3 сеттера: `counter`, `catalog` и `locked` — используются для установки значений счётчика корзины, элементов каталога и блокировки/разблокировки страницы соответственно.

### 5. Класс `Basket`

Класс `Basket` расширяет класс `Component` и представляет собой компонент, отвечающий за отображение корзины покупок. Он содержит свойства и методы для управления списком товаров, общей стоимостью и выбранными товарами.

Конструктор принимает такие аргументы:

1. `container: HTMLElement` — контейнер для компонента корзины.
2. `events: IEvents` — объект событий `IEvents`, который используется для уведомления об изменениях в модели. Это позволяет другим частям приложения подписываться на изменения модели и реагировать на них.

Класс имеет такие сеттеры:

- `items(items: HTMLElement[])` —  устанавливает элементы корзины для отображения. Если элементы есть, они заменяются в списке товаров, иначе отображается сообщение о том, что корзина пуста. Также управляет состоянием кнопки “*Оформить*”.
- `total(total: number)` — устанавливает общую сумму покупок в корзине.

### 6. Класс **`Modal`**

Класс `Modal` расширяет класс `Component` и представляет компонент модального окна, который позволяет отображать контент поверх основного контента и взаимодействовать с ним.

Конструктор принимает такие аргументы:

1. `container: HTMLElement` — контейнер для компонента модального окна.
2. `events: IEvents` — объект событий `IEvents`, который используется для уведомления об изменениях в модели. Это позволяет другим частям приложения подписываться на изменения модели и реагировать на них.

Класс имеет такие методы:

- `content(value: HTMLElement)` — устанавливает контент модального окна.
- `open()` — открывает модальное окно.
- `close()` — закрывает модальное окно.
- `render(data: IModalData): HTMLElement` — переопределяет метод родительского класса. Используется для отображения модального окна с данными из объекта `data`.

### 7. Класс **`Success`**

Класс **`Success`** расширяет класс `Component` и представляет компонент для отображения сообщения об успешном завершении какого-либо действия или операции.

Конструктор принимает такие аргументы:

1. `actions: ISuccessActions` — действия, связанные с успешным сообщением.
2. `container: HTMLElement` — контейнер для компонента успешного сообщения.

Класс имеет такой сеттер:

- `total(value: number)` — отвечает за отображение итоговой суммы покупки.

### 7. Класс **`Tabs`**

Класс **`Tabs`** расширяет класс `Component` и представляет компонент для отображения вкладок, которые пользователь может использовать для выбора способа оплаты в корзине. 

Конструктор принимает такие аргументы:

1. `actions: TabActions` — (опционально) действия, связанные с выбором вкладки.
2. `container: HTMLElement` — контейнер для компонента вкладок.

Класс имеет такие методы:

- `selected(name: string)` — устанавливает выбранную вкладку по имени.

## Ключевые типы данных

```jsx
//Данные, которые имеет товар
interface IProductItem {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
}

//Модель для управлния состоянием
interface IAppState {
	basketItems: IProductItem[];
	catalog: IProductItem[];
	basket: string[];
	order: IOrderForm | null;
}

//Данные заказа
interface IOrderForm {
	payment: string;
	address: string;
	email: string;
	phone: string;
}

//Список товаров в заказе
interface IOrder extends IOrderForm {
	total: number;
	items: string[];
}

//Ошибки формы
type FormErrors = Partial<Record<keyof IOrder, string>>;

//Результат заказа
interface IOrderResult {
    id: string;
    total: number;
}
```